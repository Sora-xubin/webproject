<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" th:href="@{../assets/layui/css/layui.css}">
    <title>项目周期管理系统</title>
</head>

<body>
<table id="projects" class="layui-table" style="margin-top:0;">
    <thead>
    <th style="display: none">项目编号</th>
    <th>项目名</th>
    <th>状态</th>
    <th>操作</th>
    </thead>
    <tbody>
    <tr th:each="project : ${projects}">
        <td class="projectCode" style="display: none" th:text="${project.code}"></td>
        <td th:text="${project.name}"></td>
        <td th:switch="${project.state}">
            <span th:case="1">已立项</span>
            <span th:case="2">中期检查</span>
            <span th:case="3">中期检查待整改</span>
            <span th:case="4">最终检查</span>
        </td>
        <td>
            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal layui-btn-sm setBtn">查看评审</button>
        </td>
    </tr>
    </tbody>
</table>
<div id="page" th:attr="data-total=${projects.totalElements},data-curr=${projects.number+1}"></div>
</body>

<!-- import JavaScript -->
<script th:src="@{../assets/layui/layui.all.js}"></script>
<script>
    layui.use(['layer', 'jquery', 'laydate','laypage'], function () {
        var layer = layui.layer,
                $ = layui.$,
                laydate = layui.laydate,
                laypage = layui.laypage;

        laydate.render({
            elem: '#datepicker'
        });

        laypage.render({
            elem: 'page',
            curr: $('#page').attr('data-curr'),
            count: $('#page').attr('data-total'),
            limit: 5,
            jump: function(obj, first){
                if(!first) {
                    window.location.href = "/project/list?page=" + obj.curr + "&size=5"
                }
            }
        })

        $('.setBtn').click(function setInfo() {
            var code = $(this).parent().parent().children(".projectCode").text();
            window.location.href = '/project_comment_list?projectCode=' + code;
        });

    });
</script>

</html>